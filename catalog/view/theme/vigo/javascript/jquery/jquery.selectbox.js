!function(e){e.fn.selectbox=function(t){var s=e.extend({styleClass:""},t);e(this).each(function(){function t(){var t=a.find("option"),s=t.filter(":selected"),o=t.filter(":first").text();t.filter(":first").attr("data-image")&&(o='<img src="'+t.filter(":first").attr("data-image")+'"/>'+o),s.length&&(o=s.text(),s.attr("data-image")&&(o='<img src="'+s.attr("data-image")+'"/>'+o));var d="";for(i=0;i<t.length;i++){var n="",c=' class="disabled"';t.eq(i).is(":selected")?(n=' class="selected sel"',d+="<li"+n+"><a>",t.eq(i).attr("data-image")&&(d+='<img src="'+t.eq(i).attr("data-image")+'"/>'),d+=t.eq(i).text()+"</a></li>"):t.eq(i).is(":disabled")?(n=c,d+="<li"+n+"><a>"+t.eq(i).text()+"</a></li>"):(d+="<li"+n+'><a onclick="'+t.eq(i).val()+'">',t.eq(i).attr("data-image")&&(d+='<img src="'+t.eq(i).attr("data-image")+'"/>'),d+=t.eq(i).html()+"</a></li>")}var r=e('<span class="selectbox '+l+'" style="display:inline-block;position:relative"><div class="select" style="float:left;position:relative;z-index:10000"><div class="text">'+o+'</div><b class="trigger"><i class="arrow"></i></b></div><div class="dropdown" style="position:absolute;z-index:9999;overflow:auto;overflow-x:hidden;list-style:none"><ul>'+d+"</ul></div></span>");a.before(r).css({position:"absolute",top:-9999});var f=r.find("div.select"),u=r.find("div.text"),h=r.find("div.dropdown"),v=h.find("li"),p=r.outerHeight();"auto"==h.css("left")&&h.css({left:0}),"auto"==h.css("top")&&h.css({top:p});var g=v.outerHeight(),x=h.css("top");h.hide(),h.css("width",h.parent().width()+"px"),f.click(function(){var t=r.offset().top,s=e(window).height()-p-(t-e(window).scrollTop());return s<0||s<6*g?(h.height("auto").css({top:"auto",bottom:x}),h.outerHeight()>t-e(window).scrollTop()-20&&h.height(Math.floor((t-e(window).scrollTop()-20)/g)*g)):s>6*g&&(h.height("auto").css({bottom:"auto",top:x}),h.outerHeight()>s-20&&h.height(Math.floor((s-20)/g)*g)),h.css("width",h.parent().width()+"px"),e("span.selectbox").css({zIndex:1}).removeClass("focused"),r.css({zIndex:3}),h.is(":hidden")&&(e("div.dropdown:visible").hide(),h.fadeIn("fast")),!1}),e("span.selectbox").mouseleave(function(){return h.fadeOut("fast"),!1}),v.hover(function(){e(this).siblings().removeClass("selected")});var m=v.filter(".selected").text();v.filter(":not(.disabled)").click(function(){var s=e(this).text();m!=s&&(e(this).addClass("selected sel").siblings().removeClass("selected sel"),t.removeAttr("selected").eq(e(this).index()).attr("selected",!0),m=s,u.text(s),a.change()),h.hide()}),h.mouseout(function(){h.find("li.sel").addClass("selected")}),a.focus(function(){e("span.selectbox").removeClass("focused"),r.addClass("focused")}).keyup(function(){u.text(t.filter(":selected").text()),v.removeClass("selected sel").eq(t.filter(":selected").index()).addClass("selected sel")}),e(document).on("click",function(t){e(t.target).parents().hasClass("selectbox")||(h.hide().find("li.sel").addClass("selected"),r.removeClass("focused"))})}var l=s.styleClass,a=e(this);a.prev("span.selectbox").length<1&&(t(),a.on("refresh",function(){a.prev().remove(),t()}))})}}(jQuery);